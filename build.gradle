/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin application project to get you started.
 */

import org.apache.commons.codec.binary.Base64 


plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '1.3.41'
    id 'com.moowork.node' version '1.3.1'
}

ext.web_dir = 'prg'


repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

kotlin {
    jvm() {
    }
    js() {
        compilations.main.kotlinOptions {
            moduleKind='amd'
        }
    }
    sourceSets {
        commonMain {
            dependencies {
                implementation kotlin('stdlib')
                implementation kotlin('stdlib-js')
             } 
        }
        commonTest {
            dependencies {
                implementation kotlin('test-common')
                implementation kotlin('test')
                implementation kotlin('test-junit')
                implementation kotlin('test-js')
            }
        }
        jsMain {
            dependencies {
                implementation kotlin('stdlib')
                implementation kotlin('stdlib-js')
                implementation 'org.jetbrains.kotlinx:kotlinx-html-js:0.6.12'
            }
        }
        jvmMain {
            dependencies {
               implementation kotlin('stdlib') 
            }
        }
    }
    targets.all {
        
    }
}
    

build.doLast {
    copy {
        includeEmptyDirs false
        from 'build/classes/kotlin/js/main'
        into "${web_dir}"
    }
    copy {
        includeEmptyDirs false
        exclude 'kotlin-test/'
        from 'build/js/packages_imported/'
        into "${web_dir}"
    }
    copy {
        includeEmptyDirs false
        from 'build/processedResources/js/main/'
        into "${web_dir}/mswp"
    }
    copy {
        includeEmptyDirs false
        from 'node_modules/@fortawesome/fontawesome-free/js/fontawesome.js'
        into "${web_dir}/fontawesome-free/js"
    }
    copy {
        includeEmptyDirs false     
        from 'node_modules/@fortawesome/fontawesome-free/js/solid.js'
        into "${web_dir}/fontawesome-free/js"           
    }
    copy {
        includeEmptyDirs false     
        from 'node_modules/@fortawesome/fontawesome-free/webfonts'
        into "./webfonts"
    }
}

clean.doFirst {
    delete "${web_dir}/"
    delete "./webfonts"
    delete "./css"
}
